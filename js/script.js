productosDB = [
    { id: 0, nombre: "Adidas T4 Fire", marca: "Adidas", genero: "Hombre", precio: 125000, rutaImagen: "img/0.jpg", stock: 7 },
    { id: 1, nombre: "Nike Air Max 270", marca: "Nike", genero: "Hombre", precio: 135000, rutaImagen: "img/1.jpg", stock: 14 },
    { id: 2, nombre: "Reebok Classic Leather", marca: "Reebok", genero: "Hombre", precio: 110000, rutaImagen: "img/2.jpg", stock: 18 },
    { id: 3, nombre: "Puma Future Rider", marca: "Puma", genero: "Hombre", precio: 115000, rutaImagen: "img/3.jpg", stock: 5 },
    { id: 4, nombre: "Converse Chuck Taylor All Star", marca: "Converse", genero: "Hombre", precio: 90000, rutaImagen: "img/4.jpg", stock: 12 },
    { id: 5, nombre: "Vans Old Skool", marca: "Vans", genero: "Hombre", precio: 95000, rutaImagen: "img/5.jpg", stock: 2 },
    { id: 6, nombre: "New Balance 574", marca: "New Balance", genero: "Hombre", precio: 120000, rutaImagen: "img/6.jpg", stock: 9 },
    { id: 7, nombre: "Adidas Superstar", marca: "Adidas", genero: "Hombre", precio: 130000, rutaImagen: "img/7.jpg", stock: 17 },
    { id: 8, nombre: "Nike Air Force 1", marca: "Nike", genero: "Hombre", precio: 140000, rutaImagen: "img/8.jpg", stock: 10 },
    { id: 9, nombre: "Reebok Club C 85", marca: "Reebok", genero: "Hombre", precio: 100000, rutaImagen: "img/9.jpg", stock: 4 },
    { id: 10, nombre: "Puma Suede Classic", marca: "Puma", genero: "Hombre", precio: 95000, rutaImagen: "img/10.jpg", stock: 20 },
    { id: 11, nombre: "Converse One Star", marca: "Converse", genero: "Hombre", precio: 85000, rutaImagen: "img/11.jpg", stock: 11 },
    { id: 12, nombre: "Vans Sk8-Hi", marca: "Vans", genero: "Hombre", precio: 105000, rutaImagen: "img/12.jpg", stock: 16 },
    { id: 13, nombre: "New Balance 990v5", marca: "New Balance", genero: "Hombre", precio: 150000, rutaImagen: "img/13.jpg", stock: 8 },
    { id: 14, nombre: "Adidas Ultraboost", marca: "Adidas", genero: "Hombre", precio: 160000, rutaImagen: "img/14.jpg", stock: 3 },
    { id: 15, nombre: "Nike React Infinity Run", marca: "Nike", genero: "Hombre", precio: 145000, rutaImagen: "img/15.jpg", stock: 6 },
    { id: 16, nombre: "Reebok Zig Kinetica", marca: "Reebok", genero: "Hombre", precio: 130000, rutaImagen: "img/16.jpg", stock: 13 },
    { id: 17, nombre: "Puma RS-X3", marca: "Puma", genero: "Hombre", precio: 110000, rutaImagen: "img/17.jpg", stock: 19 },
    { id: 18, nombre: "Converse Jack Purcell", marca: "Converse", genero: "Hombre", precio: 90000, rutaImagen: "img/18.jpg", stock: 1 },
    { id: 19, nombre: "Vans Authentic", marca: "Vans", genero: "Hombre", precio: 80000, rutaImagen: "img/19.jpg", stock: 0 },
    { id: 20, nombre: "Adidas T4 Fire", marca: "Adidas", genero: "Mujer", precio: 125000, rutaImagen: "img/0.jpg", stock: 8 },
    { id: 21, nombre: "Nike Air Max 270", marca: "Nike", genero: "Mujer", precio: 135000, rutaImagen: "img/1.jpg", stock: 13 },
    { id: 22, nombre: "Reebok Classic Leather", marca: "Reebok", genero: "Mujer", precio: 110000, rutaImagen: "img/2.jpg", stock: 2 },
    { id: 23, nombre: "Puma Future Rider", marca: "Puma", genero: "Mujer", precio: 115000, rutaImagen: "img/3.jpg", stock: 10 },
    { id: 24, nombre: "Converse Chuck Taylor All Star", marca: "Converse", genero: "Mujer", precio: 90000, rutaImagen: "img/4.jpg", stock: 18 },
    { id: 25, nombre: "Vans Old Skool", marca: "Vans", genero: "Mujer", precio: 95000, rutaImagen: "img/5.jpg", stock: 15 },
    { id: 26, nombre: "New Balance 574", marca: "New Balance", genero: "Mujer", precio: 120000, rutaImagen: "img/6.jpg", stock: 5 },
    { id: 27, nombre: "Adidas Superstar", marca: "Adidas", genero: "Mujer", precio: 130000, rutaImagen: "img/7.jpg", stock: 7 },
    { id: 28, nombre: "Nike Air Force 1", marca: "Nike", genero: "Mujer", precio: 140000, rutaImagen: "img/8.jpg", stock: 12 },
    { id: 29, nombre: "Reebok Club C 85", marca: "Reebok", genero: "Mujer", precio: 100000, rutaImagen: "img/9.jpg", stock: 4 },
    { id: 30, nombre: "Puma Suede Classic", marca: "Puma", genero: "Mujer", precio: 95000, rutaImagen: "img/10.jpg", stock: 20 },
    { id: 31, nombre: "Converse One Star", marca: "Converse", genero: "Mujer", precio: 85000, rutaImagen: "img/11.jpg", stock: 17 },
    { id: 32, nombre: "Vans Sk8-Hi", marca: "Vans", genero: "Mujer", precio: 105000, rutaImagen: "img/12.jpg", stock: 6 },
    { id: 33, nombre: "New Balance 990v5", marca: "New Balance", genero: "Mujer", precio: 150000, rutaImagen: "img/13.jpg", stock: 16 },
    { id: 34, nombre: "Adidas Ultraboost", marca: "Adidas", genero: "Mujer", precio: 160000, rutaImagen: "img/14.jpg", stock: 3 },
    { id: 35, nombre: "Nike React Infinity Run", marca: "Nike", genero: "Mujer", precio: 145000, rutaImagen: "img/15.jpg", stock: 19 },
    { id: 36, nombre: "Reebok Zig Kinetica", marca: "Reebok", genero: "Mujer", precio: 130000, rutaImagen: "img/16.jpg", stock: 1 },
    { id: 37, nombre: "Puma RS-X3", marca: "Puma", genero: "Mujer", precio: 110000, rutaImagen: "img/17.jpg", stock: 14 },
    { id: 38, nombre: "Converse Jack Purcell", marca: "Converse", genero: "Mujer", precio: 90000, rutaImagen: "img/18.jpg", stock: 9 },
    { id: 39, nombre: "Vans Authentic", marca: "Vans", genero: "Mujer", precio: 80000, rutaImagen: "img/19.jpg", stock: 11 }
]

principal(productosDB)

function principal(productos) {
    let carrito = carritoLS()
    renderizarCarrito(carrito)

    renderizarProductos(productos)

    let botonBuscar = document.getElementById("botonBuscar")
    botonBuscar.onclick = () => filtrarYRenderizar(productos)

    let inputBusqueda = document.getElementById("inputBusqueda")
    inputBusqueda.addEventListener("keypress", (e) => filtrarYRenderizarEnter(productos, e))

    renderizarProductos(productos)


}








function carritoLS() {
    let carrito = []
    let carritoLS = JSON.parse(localStorage.getItem("carrito"))
    if (carritoLS) {
        carrito = carritoLS
    }
    return carrito
}

function renderizarProductos(productos) {
    let contenedorProductos = document.getElementById("contenedorProductos")
    contenedorProductos.innerHTML = ""

    productos.forEach(producto => {
        let { id, nombre, marca, genero, precio, rutaImagen, stock } = producto

        let tarjetaProducto = document.createElement("div")
        tarjetaProducto.className = "tarjetaProducto"
        if (stock === 0) {
            tarjetaProducto.classList.add("sinStock");
        }
        tarjetaProducto.innerHTML = `
        <img src=${rutaImagen}></img>
        <h3>${marca}</h3>
        <h4>${nombre} ${genero}</h4>
        <h3>$${precio.toLocaleString()}</h3>
        <h4>${stock === 0 ? "Sin stock" : `Stock disponible: ${stock}`}</h4>
        <button id=botonCarrito${id} class=${stock === 0 ? "oculto" : ""}>Agregar al carrito</button>
        `
        contenedorProductos.appendChild(tarjetaProducto)

        let botonAgregarAlCarrito = document.getElementById("botonCarrito" + id)
        botonAgregarAlCarrito.addEventListener("click", (e) => agregarProductoAlCarrito(e, productos))


    })
}

function agregarProductoAlCarrito(e, productos) {
    console.log(e)
    console.log(productos)
    let carrito = carritoLS()
    console.log(carrito)
    let idDelProducto = Number(e.target.id.substring(12))

    let posProductoEnCarrito = carrito.findIndex((producto) => producto.id === Number(idDelProducto))
    let productoBuscado = productos.find((producto) => producto.id === Number(idDelProducto))

    if (posProductoEnCarrito !== -1) {
        carrito[posProductoEnCarrito].unidades++
        carrito[posProductoEnCarrito].subtotal = carrito[posProductoEnCarrito].precioUnitario * carrito[posProductoEnCarrito].unidades
    } else {
        carrito.push({
            id: productoBuscado.id, nombre: productoBuscado.nombre, precioUnitario: productoBuscado.precio, unidades: 1, subtotal: productoBuscado.precio, rutaImagen: productoBuscado.rutaImagen
        })
    }

    localStorage.setItem("carrito", JSON.stringify(carrito))
    renderizarCarrito(carrito)
}

function filtrarYRenderizar(productos) {
    let productosFiltrados = filtrarProductos(productos)
    renderizarProductos(productosFiltrados)
    limpiarInput()
}

function filtrarYRenderizarEnter(productos, e) {
    if (e.keyCode === 13) {
        let productosFiltrados = filtrarProductos(productos)
        renderizarProductos(productosFiltrados)
        limpiarInput()
    }

}

function filtrarProductos(productos) {
    let inputBusqueda = document.getElementById("inputBusqueda").value.toLowerCase()
    return productos.filter(producto =>
        producto.nombre.toLowerCase().includes(inputBusqueda) ||
        producto.genero.toLowerCase().includes(inputBusqueda)
    )
}
function limpiarInput() {
    document.getElementById("inputBusqueda").value = ""
}

function renderizarCarrito() {
    let carrito = carritoLS()
    let contenedorCarrito = document.getElementById("contenedorCarrito")
    contenedorCarrito.innerHTML = `<h2>Carrito de compras</h2>`


    carrito.forEach(producto => {
        let tarjetaProductoCarrito = document.createElement("div")
        tarjetaProductoCarrito.className = "tarjetaProductoCarrito"
        tarjetaProductoCarrito.id = "tarjetaProductoCarrito" + producto.id
        tarjetaProductoCarrito.innerHTML = `
        <img src=${producto.rutaImagen}></img>
        <p>${producto.nombre}</p>
        <p>$${producto.precioUnitario.toLocaleString()}</p>
        <div class=unidades>
            <button id=dec${producto.id}>-</button>
            <p>${producto.unidades}</p>
            <button id=inc${producto.id}>+</button>
        </div>
        <p>$${producto.subtotal.toLocaleString()}</p>
        <button id=eliminar${producto.id}>Eliminar</button>
        `
        contenedorCarrito.appendChild(tarjetaProductoCarrito)

    

        //let botonDecUnidad = document.getElementById("dec" + producto.id)
        //botonDecUnidad.addEventListener("click", decrementarUnidad)

        //let botonIncUnidad = document.getElementById("inc" + producto.id)
        //botonIncUnidad.addEventListener("click", incrementarUnidad)

        //let botonEliminar = document.getElementById("eliminar" + producto.id)
        //botonEliminar.addEventListener("click", eliminarProductoDelCarrito)

    })
    let totalCompra = calcularTotalCompra(carrito)

    let totalDiv = document.createElement("div")
    totalDiv.className = "totalCompra"
    totalDiv.innerHTML = `<p>Total de la compra: $${totalCompra}</p>`
    console.log(totalCompra)
    contenedorCarrito.appendChild(totalDiv);

}

function calcularTotalCompra(carrito) {
    let total = 0;
    carrito.forEach(producto => {
        total += producto.subtotal;
    });
    return total.toLocaleString();
}